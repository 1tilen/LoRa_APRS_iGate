name: Commit Test Build

on:
    push:
        branches:
            - '*'

jobs:
    build:
        runs-on: ubuntu-latest
        strategy:
            fail-fast: false
            matrix:
              board:
                - name: Ttgo-lora32-v21
                  board_type: ttgo-lora32-v21
                - name: Heltec-lora32-v2
                  board_type: heltec-lora32-v2
                - name: Heltec_wifi_lora_32_V3
                  board_type: heltec_wifi_lora_32_V3
                - name: Heltec_wireless_stick
                  board_type: heltec_wireless_stick
                - name: Heltec_wireless_stick_lite_v3
                  board_type: heltec_wireless_stick_lite_v3
                - name: Heltec_ht-ct62
                  board_type: heltec_ht-ct62
                - name: ESP32_DIY_LoRa
                  board_type: ESP32_DIY_LoRa
                - name: ESP32_DIY_1W_LoRa
                  board_type: ESP32_DIY_1W_LoRa
                - name: Ttgo-t-beam-v1_2
                  board_type: ttgo-t-beam-v1_2
                - name: Ttgo-t-beam-v1
                  board_type: ttgo-t-beam-v1
                - name: Ttgo-t-beam-v1_SX1268
                  board_type: ttgo-t-beam-v1_SX1268
                - name: Ttgo-t-beam-v1_2_SX1262
                  board_type: ttgo-t-beam-v1_2_SX1262
                - name: ESP32_DIY_LoRa_A7670
                  board_type: ESP32_DIY_LoRa_A7670
                - name: Heltec_wireless_tracker
                  board_type: heltec_wireless_tracker
                - name: OE5HWN_MeshCom
                  board_type: OE5HWN_MeshCom
                - name: WEMOS-LOLIN32-OLED-DIY
                  board_type: WEMOS-LOLIN32-OLED-DIY
                - name: WEMOS-D1-R32-RA02
                  board_type: WEMOS-D1-R32-RA02
                - name: Ttgo-lora32-v21-915
                  board_type: ttgo-lora32-v21-915
        steps:
            - uses: actions/checkout@v3

            - uses: actions/setup-python@v4
              with:
                  python-version: "3.9"

            - name: Install PlatformIO Core
              run: pip install --upgrade platformio

            - name: Determine board type
              id: determine-board
              run: |
                if [[ "${{ matrix.board.board_type }}" == "esp32s3" ]]; then
                  export BOARD_ENV="esp32s3"
                else
                  if [[ "${{ matrix.board.board_type }}" == "esp32c3" ]]; then
                    export BOARD_ENV="esp32c3"
                  else
                    export BOARD_ENV="esp32"
                  fi
                fi
              shell: bash

            - name: Build target
              run: pio run -e ${{ matrix.board.name }}

            - name: Build FS
              run: pio run --target buildfs -e ${{ matrix.board.name }}